machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - docker build -t apiaryio/dnsdock .

test:
  override:
    - docker run -v /var/run/docker.sock:/var/run/docker.sock -p $(ip route | awk '/docker/ { print $NF }'):53:53/udp --entrypoint=/bin/bash apiaryio/dnsdock -c make test

deployment:
  production:
    branch: production
    commands:
      - docker push apiaryio/dnsdock:latest
